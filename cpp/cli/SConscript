# SConscript file for building cli.cpp
import sys
# Import SCons symbols
from SCons.Script import Environment, Dir, File
# Set build type: debug or release
build_type = ARGUMENTS.get('build', 'release')

if build_type == 'debug':
    env = Environment(CXXFLAGS=['-std=c++20', '-g', '-O0', '-DDEBUG'])
    print('Building in DEBUG mode')
else:
    env = Environment(CXXFLAGS=['-std=c++20', '-O2'])
    print('Building in RELEASE mode')


# Add include paths for CLI11.hpp, spdlog, and local src headers using SCons path functions
cli11_include = Dir('#../lib/cli').abspath
spdlog_include = Dir('#../lib/spdlog/include').abspath
local_include = Dir('#src').abspath
env.Append(CPPPATH=[cli11_include, spdlog_include, local_include])

# Source files using SCons path functions
sources = [
    File('#src/cli.cpp').abspath,
    File('#src/add.cpp').abspath,
    File('#src/multiply.cpp').abspath,
    File('#src/stacktrace.cpp').abspath,
    File('#src/log.cpp').abspath,
]

# Define FMT_HEADER_ONLY globally for all files
env.Append(CPPDEFINES=['FMT_HEADER_ONLY'])

# Build only the main CLI executable
env.Program(target='run', source=sources)
